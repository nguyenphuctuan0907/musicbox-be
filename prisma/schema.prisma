generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "mysql"
}

model Bill {
  id              Int        @id @default(autoincrement())
  start           DateTime? // thời gian bắt đầu tạo bill
  end             DateTime? // thời gian kết thúc bill
  boxId           Int        @map("box_id")
  creatorId       Int?       @map("creator_id")
  boxPriceId      Int?       @map("boxPriceInterval_id")
  paymentMethod   PaymentMethod? // null = chưa thanh toán
  qrCodeUrl       String?   // link QR
  timeUsed        Int        @default(0) @map("time_used") // thời gian sử dụng tính bằng phút
  subtotal        Int // tiền trước khi giảm giá
  discountAmount  Int        @default(0) @map("discount_amount") // tiền giảm giá
  discountPercent Float?     @map("discount_percent") // phần trăm giảm giá
  total           Int        @default(0) // tiền khách phải trả
  status          BillStatus @default(DRAFT) // trạng thái bill
  createdAt       DateTime   @default(now()) @map("created_at")
  box             Box        @relation(fields: [boxId], references: [id], map: "Bill_boxId_fkey")
  user            User?      @relation(fields: [creatorId], references: [id], map: "Bill_creatorId_fkey")
  priceRule       BoxPriceInterval?      @relation(fields: [boxPriceId], references: [id], map: "Bill_boxPriceId_fkey")
  discountType    TypeDiscount?

  billdish BillDish[]

  @@index([boxId], map: "Bill_boxId_fkey")
  @@index([creatorId], map: "Bill_creatorId_fkey")
  @@index([boxPriceId], map: "Bill_boxPriceId_fkey")
}

model BillDish {
  id       Int @id @default(autoincrement())

  billId   Int @map("bill_id")
  dishId   Int @map("dish_id")

  quantity Int @default(1)
  price    Int

  bill Bill @relation(fields: [billId], references: [id], onDelete: Cascade, map: "BillDish_billId_fkey")
  dish Dish @relation(fields: [dishId], references: [id], map: "BillDish_dishId_fkey")

  @@unique([billId, dishId])
  @@index([billId])
  @@index([dishId])
  @@map("bill_dish")
}

model Box {
  id                  Int                @id @default(autoincrement())
  name                String // tên phòng/box
  defaultPricePerHour Int                @map("default_price_per_hour") // tiền mặc định
  size                BoxSize
  status              BoxStatus          @default(AVAILABLE)
  createdAt           DateTime           @default(now()) @map("created_at")
  bill                Bill[]
}

model BoxPriceInterval {
  id           Int      @id @default(autoincrement())
  name         String? // tên khung giờ
  pricePerHour Int      @map("price_per_hour") // giá theo giờ
  startTime    String   @map("start_time") // thời gian bắt đầu (định dạng HH:MM)
  endTime      String   @map("end_time") // thời gian kết thúc (định dạng HH:MM)
  dayType      DayType  @map("day_type") // loại ngày áp dụng
  minPeople    Int?     @map("min_people") // số người tối thiểu
  maxPeople    Int?     @map("max_people") // số người tối đa
  priority     Int      @default(0) // độ ưu tiên khi áp dụng(từ nhỏ đến lớn)
  createdAt    DateTime @default(now()) @map("created_at")
  bills        Bill[]
}

model Dish {
  id        Int        @id @default(autoincrement())
  name      String // tên món
  price     Int // giá món
  type      DishType // loại món
  createdAt DateTime   @default(now()) @map("created_at")
  billDish  BillDish[]
}

model User {
  id        Int       @id @default(autoincrement())
  username  String
  role      UserRole?
  createdAt DateTime  @default(now()) @map("created_at")
  password  String
  bill      Bill[]
}

enum UserRole {
  ADMIN
  USER
}

enum DiscountType {
  BILL // giảm theo tổng bill
  DISH // giảm theo món
  TIME // giảm theo giờ hát
}

enum BillStatus {
  DRAFT // Khởi tạo
  RUNNING // Đang tính h
  PAID // Đã thanh toán
  PAYING // Đang thanh toán
  CANCELED // Huỷ bỏ
}

enum BoxSize {
  SMALL
  MEDIUM
  LARGE
}

enum BoxStatus {
  AVAILABLE // Khả dụng
  OCCUPIED // Đang sử dụng
  MAINTENANCE // Đang bảo trì
}

enum DishType {
  FOOD // đồ ăn đặt
  DRINK // nước uống
  SNACK // đồ ăn vặt
}

enum DayType {
  NORMAL // ngày thường
  WEEKEND // cuối tuần
  HOLIDAY // ngàu lễ
}

enum PaymentMethod {
  CASH        // Tiền mặt
  TRANSFER    // Chuyển khoản
}

enum TypeDiscount {
  VND        // Tiền 
  PERCENT    // %
}